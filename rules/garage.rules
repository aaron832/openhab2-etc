var Timer timer
var Number raceCheck = 0

rule "sensorGarageLastCom_rule"
when
        Item bayDoorGarage01 received update
or
        Item doorGarage01 received update
or
        Item tempGarage01 received update
or
        Item humGarage01 received update
then
        sensorGarageLastCom.postUpdate( new DateTimeType() )
end


rule "autoGarageLightOnBayDoor"
when
        Item bayDoorGarage01 changed to 1 
or
	Item zwave_device_node4_sensor_binary changed to ON
then
        raceCheck = 1
        if(timer!=null){
                timer.cancel
                timer = null
        }

        sendCommand(zwave_node3_garagelight_switch, ON)

        timer = createTimer(now.plusMinutes(5)) [|
                sendCommand(zwave_node3_garagelight_switch, OFF)
        ]
        raceCheck = 0
end

rule "zwave_node3_garagelight_switch_rule"
when
        Item zwave_node3_garagelight_switch changed
then
        logInfo("garage", "Light state: " + zwave_node3_garagelight_switch.state)
        if(timer!=null) and (raceCheck == 0){
                timer.cancel
                timer = null
        }
end

